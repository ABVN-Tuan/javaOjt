sap.ui.define(["sap/ui/core/mvc/Controller","./../model/models","./../model/formatter","sap/m/MessageBox","sap/m/MessageToast"],(e,t,a,s,o)=>{"use strict";return e.extend("employee.controller.homeView",{formatter:a,onInit:async function(){const e=this.getView();const a=await new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});this.byId("itemTable").bindItems({path:"EntityList>/Employees",parameters:{$expand:"role,department"},template:new sap.m.ColumnListItem({type:"Active",press:this.onPressItem.bind(this),cells:[new sap.m.Text({text:"{EntityList>firstName},{EntityList>lastName}"}),new sap.m.Text({text:"{EntityList>role/name}"}),new sap.m.Text({text:"{EntityList>department/name}"}),new sap.m.Text({text:"{EntityList>email}"}),new sap.m.Button({id:"deleteButton",icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteEmployee.bind(this),tooltip:"{i18n>deleteTooltip}",enabled:{parts:["role>/role"],formatter:this.formatter.isAdmin}})]})});this.byId("itemLeaveTable").bindItems({path:"EntityList>/leaveRequest",parameters:{$expand:"employee"},template:new sap.m.ColumnListItem({id:"leaveListItem",type:"Active",cells:[new sap.m.Text({text:"{EntityList>employee/firstName} {EntityList>employee/lastName}"}),new sap.m.Text({text:"{EntityList>startDate}"}),new sap.m.Text({text:"{EntityList>endDate}"}),new sap.m.Text({text:"{EntityList>status}"}),new sap.m.Text({text:"{EntityList>reason}"}),new sap.m.Button({id:"deleteLeaveButton",icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteLeave.bind(this),enabled:{parts:["role>/role"],formatter:this.formatter.isAdmin}})]})});await e.setModel(a,"EntityList");const s=await t.getRole(e);await t.setVisibleControl(e);console.log(this.getView().getModel("EntityList"))},onPressItem:async function(e){const a=this.getView();const s=e.getSource();const o=s.getBindingContext("EntityList");try{const e=await o.requestObject();const t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"employDetail")}catch(e){}a.getModel("VisibleControl").setProperty("/",{list:false,detail:true,create:false,listLeave:false,createLeave:false});t._setModel(a,{isEdit:false},"Edit")},onPressBack:function(){const e=this.getView();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false})},onPressLeave:function(){const e=this.getView();const t=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});e.getModel("VisibleControl").setProperty("/",{listLeave:true,createLeave:false,list:false,detail:false,create:false})},onPressEdit:function(){const e=this.getView();const t=e.getModel("Edit");const a=t.getProperty("/isEdit");t.setProperty("/isEdit",!a)},onPressCreList:function(){var e={statuses:[{key:"PENDING",text:"Pending"},{key:"APPROVED",text:"Approved"},{key:"REJECTED",text:"Rejected"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"statusModel");const a={status:"Pending",reason:"",endDate:"",startDate:"",employee:{ID:""}};const s=this.getView();s.setModel(new sap.ui.model.json.JSONModel(a),"createLeaveDetail");s.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:false,createLeave:true})},onPressCreEmp:function(){var e={Genders:[{key:"Male",text:"Male"},{key:"Female",text:"Female"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"genderModel");const a={firstName:"",lastName:"",email:"",hireDate:"",dateOfBirth:"",salary:0,gender:"",role:{ID:""},department:{ID:""}};const s=this.getView();s.setModel(new sap.ui.model.json.JSONModel(a),"createDetail");s.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:true,listLeave:false,createLeave:false})},onDeleteEmployee:function(e){const t=e.getSource().getParent();const a=t.getBindingContext("EntityList");if(!a){sap.m.MessageToast.show("No data found");return}sap.m.MessageBox.confirm("Are you sure to delete?",{onClose:async e=>{if(e===sap.m.MessageBox.Action.OK){try{if(typeof a.delete==="function"){await a.delete();sap.m.MessageToast.show("Delete success")}else{sap.m.MessageBox.error("Delete fail")}}catch(e){sap.m.MessageBox.error("Delete fail"+e.message)}}}})},onCreateEmployee:async function(){const e=this.getView();const t=e.getModel("EntityList");const a=e.getModel("createDetail").getData();try{const s=t.bindList("/Employees");if(!a.firstName||!a.lastName){sap.m.MessageBox.warning("Please fill in name.");return}if(!a.email||!a.email){sap.m.MessageBox.warning("Please fill in email.");return}if(!a.hireDate||!a.hireDate){sap.m.MessageBox.warning("Please fill in hireDate.");return}if(!a.gender){sap.m.MessageBox.warning("Please fill in gender");return}if(!a.role.ID){sap.m.MessageBox.warning("Please fill in role.");return}if(!a.department.ID){sap.m.MessageBox.warning("Please fill in department.");return}await s.create(a);await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false});sap.m.MessageToast.show("Create success")}catch(e){sap.m.MessageBox.error("Create employee fail",e)}},onCreateLeave:async function(){const e=this.getView();const t=e.getModel("EntityList");const a=e.getModel("createLeaveDetail").getData();try{const s=t.bindList("/leaveRequest");await s.create(a);sap.m.MessageToast.show("Create success");await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:true,createLeave:false})}catch(e){sap.m.MessageBox.error("Create leave request fail",e)}},onPressUpdate:async function(){const e=this.getView();const t=e.getModel("EntityList");const a=e.getModel("employDetail").getData();const s=e.getModel("employDetail").getData();try{const e=t.bindContext("/calEmpSalary(...)");await e.ready();const a=e.getParameterContext();await a.setProperty("Employee/ID",s.ID);await a.setProperty("Employee/hireDate",s.hireDate);await a.setProperty("Employee/role_ID",s.role.ID);await a.setProperty("Employee/performanceRating",parseInt(s.performanceRating,10));await e.execute();const o=await e.requestObject();if(o.value!==null&&o.value!==undefined&&!isNaN(o.value)){await t.refresh();this.getView().getModel("employDetail").setProperty("/salary",o.value)}else{sap.m.MessageBox.error("Update fail")}}catch(e){sap.m.MessageBox.error("Call function fail: "+e.message)}try{const e=`/Employees(${a.ID})`;const s=t.bindContext(e);if(!s){sap.m.MessageBox.error("Not found data");return}const o=await s.getBoundContext();o.setProperty("firstName",a.firstName);o.setProperty("lastName",a.lastName);o.setProperty("email",a.email);o.setProperty("hireDate",a.hireDate);o.setProperty("salary",a.salary);o.setProperty("performanceRating",parseInt(a.performanceRating));o.setProperty("role_ID",a.role.ID);o.setProperty("department_ID",a.department.ID);sap.m.MessageToast.show("update employee success");await t.refresh()}catch(e){sap.m.MessageBox.error("Update employee fail",e)}},onPressSalary:async function(){const e=this.getView();const t=e.getModel("EntityList");const a=e.getModel("employDetail");const s=e.getModel("employDetail").getData().ID;const o=e.getModel("employDetail").getData();try{const e=t.bindContext("/calEmpSalary(...)");await e.ready();const a=e.getParameterContext();await a.setProperty("Employee/ID",o.ID);await a.setProperty("Employee/hireDate",o.hireDate);await a.setProperty("Employee/role_ID",o.role.ID);await a.setProperty("Employee/performanceRating",parseInt(o.performanceRating,10));await e.execute();const s=await e.requestObject();if(s.value!==null&&s.value!==undefined&&!isNaN(s.value)){await t.refresh();this.getView().getModel("employDetail").setProperty("/salary",s.value);sap.m.MessageToast.show("Calculate salary success")}else{sap.m.MessageBox.error("Calculate salary fail")}}catch(e){sap.m.MessageBox.error("Call function fail: "+e.message)}},onDeleteLeave:function(e){const t=e.getSource().getParent();const a=t.getBindingContext("EntityList");if(!a){sap.m.MessageToast.show("No data found");return}sap.m.MessageBox.confirm("Are you sure to delete?",{onClose:async e=>{if(e===sap.m.MessageBox.Action.OK){try{if(typeof a.delete==="function"){await a.delete();sap.m.MessageToast.show("Delete success")}else{sap.m.MessageBox.error("Delete fail")}}catch(e){sap.m.MessageBox.error("Delete fail"+e.message)}}}})},onChangeText:function(e){const t=e.getSource();let a=t.getValue();var s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.match(s)){t.setValueState("Error");t.setValueStateText("Email not valid")}else{t.setValueState("Success");t.setValueStateText("Input email valid")}}})});
//# sourceMappingURL=homeView.controller.js.map